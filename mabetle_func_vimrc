" Mabetle Functions
" =================

"  Vimrc
function! MabetleVimrc()
    execute ':tabedit $HOME/.vim/vimrc'
endfunction
command! -bar -narg=0 MabetleVimrc  call MabetleVimrc()

"  line end blank
function! MabetleLineEndBlankDelete()
	execute ':%s/\s\+$//g'
endfunction
command! -bar -narg=0 MabetleLineEndBlankDelete  call MabetleLineEndBlankDelete()

" edit hosts
function! MabetleHosts()
	if has("win32")
		execute ':tabedit C:\Windows\System32\drivers\etc\hosts'
	else
		execute ':tabedit /etc/hosts'
	endif
endfunction
command! -bar -narg=0 MabetleHosts  call MabetleHosts()

" Sudo save.
function! MabetleSudoSave()
	execute ':w !sudo tee %'
endfunction
command! -bar -narg=0 MabetleSudoSave  call MabetleSudoSave()

"  Delete Windows ^M
function! MabetleWindowsLineEndDelete()
	execute ':%s///g'
endfunction
command! -bar -narg=0 MabetleWindowsLineEndDelete  call MabetleWindowsLineEndDelete()


"Automatically remove trailing spaces when saving a file.
autocmd BufRead,BufWrite * if ! &bin | silent! %s/\s\+$//ge | endif


"Remove indenting on empty line
"F2处理行尾的空格以及文件尾部的多余空行
map <F2> :w<CR>:call CleanupBuffer(1)<CR>:noh<CR>
function! CleanupBuffer(keep)
    " Skip binary files
    if (&bin > 0)
        return
    endif
    " Remove spaces and tabs from end of every line, if possible
    silent! %s/\s\+$//ge
    " Save current line number
    let lnum = line(".")
    " number of last line
    let lastline = line("$")
    let n        = lastline
    " while loop
    while (1)
        " content of last line
        let line = getline(n)
        " remove spaces and tab
        if (!empty(line))
            break
        endif
        let n = n - 1
    endwhile
    " Delete all empty lines at the end of file
    let start = n+1+a:keep
    if (start < lastline)
        execute n+1+a:keep . "," . lastline . "d"
    endif
    " after clean spaces and tabs, jump back
    exec "normal " . lnum . "G"
endfunction

"F12生成/更新tags文件
set tags=tags;
set autochdir
function! UpdateTagsFile()
    silent !ctags -R --fields=+ianS --extra=+q
endfunction
nmap <F12> :call UpdateTagsFile()<CR>
